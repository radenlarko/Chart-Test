import Head from "next/head";
import {
  Box,
  Grid,
  HStack,
  Select,
  Text,
  useColorModeValue,
} from "@chakra-ui/react";
import AreaChart2 from "@/components/AreaChart2";
import DonutChart from "@/components/DonutChart";
import BarChart from "@/components/BarChart";
import ColorModeToggle from "@/components/ColorModeToggle";
import { useEffect, useMemo, useState } from "react";
import dataCharts, { DataChart } from "@/utils/dataChart";
import GridItemCard from "@/components/GridItemCard";
import HeaderChart from "@/components/HeaderChart";
import { myNumberFormat } from "@/utils/myFormat";
import { mySum } from "@/utils/myFunction";

const tahun = new Date().getFullYear();

export default function Home() {
  const [selectedData, setSelectedData] = useState<DataChart[]>([]);
  const [selectYear, setSelectYear] = useState(tahun);

  useEffect(() => {
    const getCurrentData = () => {
      if (!selectYear) {
        return;
      }

      const filtered = dataCharts.filter((item) => item.label === selectYear);

      if (filtered.length === 0) {
        console.log("no data match");
        return;
      }

      setSelectedData(filtered[0].data);
    };

    getCurrentData();
  }, [selectYear]);

  const totalData = useMemo(() => {
    if (selectedData.length === 0) {
      return 0;
    }

    const val = mySum(selectedData.map((item) => item.value));
    return val;
  }, [selectedData]);

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <Box bg={useColorModeValue("gray.50", "blackAlpha.700")}>
          <Box
            position="fixed"
            top={0}
            w="full"
            backdropFilter="blur(21px)"
            transitionDelay="0s, 0s, 0s, 0s"
            transitionDuration=" 0.25s, 0.25s, 0.25s, 0s"
            transition-property="box-shadow, background-color, filter, border"
            transitionTimingFunction="linear, linear, linear, linear"
            zIndex="96"
          >
            <HStack
              minH="75px"
              maxW={"7xl"}
              mx="auto"
              px={2}
              justifyContent="space-between"
            >
              <Box>
                <Select
                  placeholder="Select option"
                  value={selectYear}
                  onChange={(val) => setSelectYear(Number(val.target.value))}
                >
                  <option value={tahun - 1}>Data {tahun - 1}</option>
                  <option value={tahun}>Data {tahun}</option>
                </Select>
              </Box>
              <ColorModeToggle />
            </HStack>
          </Box>
          <Box
            maxW={"7xl"}
            minH={"100vh"}
            mx="auto"
            pt="80px"
            px={{ base: 2, md: 8 }}
            pb={{ base: 2, md: 8 }}
          >
            <Grid
              minH={"200px"}
              templateRows={{ base: "repeat(4, auto)", lg: "repeat(3, auto)" }}
              templateColumns="repeat(5, 1fr)"
              gap={4}
            >
              <GridItemCard colSpan={{ base: 5, lg: 2 }}>
                <HeaderChart
                  title="Issue By Category"
                  value={`${myNumberFormat(totalData)} Issues`}
                  label="has ocurred"
                />
                <DonutChart dataChart={selectedData} />
              </GridItemCard>
              <GridItemCard colSpan={{ base: 5, lg: 3 }}>
                <HeaderChart
                  title="Issues Overview"
                  value={`${myNumberFormat(totalData)} Issues`}
                  label="has ocurred"
                />
                <AreaChart2
                  dataChart={selectedData}
                  rgbColor={[200, 75, 142]}
                />
              </GridItemCard>
              <GridItemCard colSpan={5}>
                <HeaderChart
                  title="Issues Overview"
                  value={`${myNumberFormat(totalData)} Issues`}
                  label="has ocurred"
                />
                <BarChart dataChart={selectedData} />
              </GridItemCard>
              <GridItemCard colSpan={5} isDark>
                <HeaderChart
                  title="Issues Overview"
                  value={`${myNumberFormat(totalData)} Issues`}
                  label="has ocurred"
                  isDark
                />
                <BarChart dataChart={selectedData} isDark />
              </GridItemCard>
            </Grid>
          </Box>
        </Box>
      </main>
    </>
  );
}
